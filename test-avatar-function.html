<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤´åƒåŠŸèƒ½æµ‹è¯• - é—²ç‹—è”åˆä¼š</title>
    <style>
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        }
        .test-section h3 {
            color: #00ff88;
            margin-bottom: 15px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #000;
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 4px solid #00ff88;
            min-height: 40px;
        }
        .error {
            border-left-color: #ff4444;
            color: #ff4444;
        }
        .success {
            border-left-color: #00ff88;
            color: #00ff88;
        }
        .avatar-display {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #00ff88;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #00ff88;">ğŸ­ å¤´åƒåŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ“¤ è·å–å¤´åƒæµ‹è¯•</h3>
            <p>æµ‹è¯• getUserAvatar å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
            <button class="btn btn-primary" onclick="testGetAvatar()">æµ‹è¯•è·å–å¤´åƒ</button>
            <div id="getAvatarResult" class="result">ç‚¹å‡»æŒ‰é’®è¿›è¡Œæµ‹è¯•</div>
        </div>

        <div class="test-section">
            <h3>ğŸ’¾ ä¿å­˜å¤´åƒæµ‹è¯•</h3>
            <p>æµ‹è¯• setUserAvatar å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
            <button class="btn btn-primary" onclick="testSetAvatar()">æµ‹è¯•ä¿å­˜å¤´åƒ</button>
            <div id="setAvatarResult" class="result">ç‚¹å‡»æŒ‰é’®è¿›è¡Œæµ‹è¯•</div>
        </div>

        <div class="test-section">
            <h3>ğŸ”„ å®Œæ•´å¤´åƒæµç¨‹æµ‹è¯•</h3>
            <p>æµ‹è¯•å®Œæ•´çš„å¤´åƒè·å–å’Œä¿å­˜æµç¨‹</p>
            <button class="btn btn-primary" onclick="testAvatarFlow()">æµ‹è¯•å®Œæ•´æµç¨‹</button>
            <div id="flowResult" class="result">ç‚¹å‡»æŒ‰é’®è¿›è¡Œæµ‹è¯•</div>
        </div>

        <div class="test-section">
            <h3>ğŸ‘¤ æ¨¡æ‹Ÿå¤´åƒæ˜¾ç¤º</h3>
            <p>æ˜¾ç¤ºè·å–åˆ°çš„å¤´åƒ</p>
            <button class="btn btn-secondary" onclick="displayAvatar()">æ˜¾ç¤ºå¤´åƒ</button>
            <div id="avatarDisplay" style="text-align: center; margin-top: 20px;"></div>
        </div>
    </div>

    <script src="js/api-client.js"></script>
    <script>
        // æµ‹è¯•è·å–å¤´åƒ
        async function testGetAvatar() {
            const resultDiv = document.getElementById('getAvatarResult');
            try {
                resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•è·å–å¤´åƒ...';
                resultDiv.className = 'result';
                
                // æ¨¡æ‹Ÿè°ƒç”¨ getUserAvatar
                const result = await window.apiClient.getUserAvatar('test@example.com');
                console.log('è·å–å¤´åƒç»“æœ:', result);
                
                if (result && result.success && result.avatar) {
                    resultDiv.innerHTML = `<span class="success">âœ… æµ‹è¯•æˆåŠŸï¼</span><br>
                        å¤´åƒURL: ${result.avatar}<br>
                        çŠ¶æ€: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ æµ‹è¯•å¤±è´¥ï¼</span><br>
                        è¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®`;
                }
            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `<span class="error">âŒ æµ‹è¯•å¤±è´¥ï¼</span><br>
                    é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯•ä¿å­˜å¤´åƒ
        async function testSetAvatar() {
            const resultDiv = document.getElementById('setAvatarResult');
            try {
                resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•ä¿å­˜å¤´åƒ...';
                resultDiv.className = 'result';
                
                // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„å¤´åƒæ•°æ®URLï¼ˆç®€å•çš„base64å›¾ç‰‡ï¼‰
                const mockAvatarData = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjQwIiBmaWxsPSIjMDBmZjg4Ii8+CiAgICA8dGV4dCB4PSI1MCIgeT0iNTUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiMwMDAiIGZvbnQtc2l6ZT0iMjAiPuWboumYnzwvdGV4dD4KPC9zdmc+';
                
                // æ¨¡æ‹Ÿè°ƒç”¨ setUserAvatar
                const result = await window.apiClient.setUserAvatar('test@example.com', mockAvatarData);
                console.log('ä¿å­˜å¤´åƒç»“æœ:', result);
                
                if (result && result.success) {
                    resultDiv.innerHTML = `<span class="success">âœ… æµ‹è¯•æˆåŠŸï¼</span><br>
                        çŠ¶æ€: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}<br>
                        æ¶ˆæ¯: ${result.message || 'å¤´åƒä¿å­˜æˆåŠŸ'}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ æµ‹è¯•å¤±è´¥ï¼</span><br>
                        è¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®`;
                }
            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `<span class="error">âŒ æµ‹è¯•å¤±è´¥ï¼</span><br>
                    é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯•å®Œæ•´æµç¨‹
        async function testAvatarFlow() {
            const resultDiv = document.getElementById('flowResult');
            try {
                resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•å®Œæ•´å¤´åƒæµç¨‹...';
                resultDiv.className = 'result';
                
                // ç¬¬ä¸€æ­¥ï¼šä¿å­˜å¤´åƒ
                const mockAvatarData = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjQwIiBmaWxsPSIjMDBmZjg4Ii8+CiAgICA8dGV4dCB4PSI1MCIgeT0iNTUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiMwMDAiIGZvbnQtc2l6ZT0iMjAiPuWboumYnzwvdGV4dD4KPC9zdmc+';
                const saveResult = await window.apiClient.setUserAvatar('test@example.com', mockAvatarData);
                
                if (saveResult && saveResult.success) {
                    // ç¬¬äºŒæ­¥ï¼šè·å–å¤´åƒ
                    const getResult = await window.apiClient.getUserAvatar('test@example.com');
                    
                    if (getResult && getResult.success && getResult.avatar) {
                        resultDiv.innerHTML = `<span class="success">âœ… å®Œæ•´æµç¨‹æµ‹è¯•æˆåŠŸï¼</span><br>
                            ä¿å­˜: ${saveResult.success ? 'æˆåŠŸ' : 'å¤±è´¥'}<br>
                            è·å–: ${getResult.success ? 'æˆåŠŸ' : 'å¤±è´¥'}<br>
                            å¤´åƒURL: ${getResult.avatar}`;
                    } else {
                        resultDiv.innerHTML = `<span class="error">âŒ è·å–å¤´åƒå¤±è´¥ï¼</span>`;
                    }
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ä¿å­˜å¤´åƒå¤±è´¥ï¼</span>`;
                }
            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `<span class="error">âŒ æµ‹è¯•å¤±è´¥ï¼</span><br>
                    é”™è¯¯: ${error.message}`;
            }
        }

        // æ˜¾ç¤ºå¤´åƒ
        async function displayAvatar() {
            const displayDiv = document.getElementById('avatarDisplay');
            try {
                const result = await window.apiClient.getUserAvatar('test@example.com');
                
                if (result && result.success && result.avatar) {
                    displayDiv.innerHTML = `
                        <div>
                            <img src="${result.avatar}" class="avatar-display" alt="ç”¨æˆ·å¤´åƒ">
                            <p style="color: #00ff88; margin-top: 10px;">å¤´åƒæ˜¾ç¤ºæˆåŠŸï¼</p>
                        </div>
                    `;
                } else {
                    displayDiv.innerHTML = `<p style="color: #ff4444;">æ— æ³•æ˜¾ç¤ºå¤´åƒ</p>`;
                }
            } catch (error) {
                console.error('æ˜¾ç¤ºå¤´åƒå¤±è´¥:', error);
                displayDiv.innerHTML = `<p style="color: #ff4444;">æ˜¾ç¤ºå¤´åƒå¤±è´¥: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>